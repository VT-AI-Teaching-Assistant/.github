# VT AI Lecture Assistant - Complete System Documentation

> **Generated:** January 2026
> **System Age:** ~4 months of active development
> **Total Services:** 5 + 1 SQL-DB Schema Directory

---

Checkout : https://aita.cisl.cs.vt.edu/

## Table of Contents

1. [System Overview](#1-system-overview)
2. [Repository / Service Breakdown](#2-repository--service-breakdown)
3. [RAG Architecture (Milvus)](#3-rag-architecture-milvus)
4. [Component Interaction & Communication](#4-component-interaction--communication)
5. [Features Breakdown](#5-features-breakdown)
6. [Security Model](#6-security-model)
7. [System Architecture](#7-system-architecture)
8. [Architecture Evolution](#8-architecture-evolution)
9. [Project History & Metrics](#9-project-history--metrics)
10. [Bottlenecks, Risks & Improvements](#10-bottlenecks-risks--improvements)
11. [Glossary](#11-glossary)

---

# ğŸ“Œ 1. System Overview

## 1.1 What the System Does

The **VT AI Lecture Assistant** is an intelligent educational platform designed for Virginia Tech (VT) that serves as an AI-powered Teaching Assistant for university courses. The system integrates with **Canvas LMS** to provide:

- **AI-powered Question & Answer (QA)** - Students can ask questions about course materials and receive contextually relevant answers generated by AWS Bedrock AI models
- **Lecture Notes Generation** - Automatic generation of structured notes from lecture transcripts using Claude AI
- **Content Vectorization** - Course materials (notes, syllabus, assignments, announcements, modules) are converted into vector embeddings for semantic search
- **Hybrid Search** - Combines semantic search (70%) with keyword search via BM25 (30%) for optimal retrieval
- **Grade Retrieval** - Students and instructors can query grades from Canvas LMS
- **Analytics Dashboard** - Instructors can view QA usage statistics and student engagement metrics
- **Dispute Resolution** - Students can dispute AI-generated answers, with instructor resolution workflow

## 1.2 Business Purpose

Based on code analysis, the system serves:

| User Type | Primary Use Cases |
|-----------|-------------------|
| **Students** | Ask course-related questions, view grades, access lecture notes, browse transcripts, dispute incorrect AI answers |
| **Instructors** | Register courses from Canvas, upload transcripts, view QA analytics, resolve disputes, manage course content |
| **System** | Auto-sync content from Canvas, generate notes, vectorize content, power semantic search |

## 1.3 Overall Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER LAYER                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚             VT-AI-Lecture-Assistant-Frontend (React)                 â”‚    â”‚
â”‚  â”‚                 - React 18 + TypeScript                              â”‚    â”‚
â”‚  â”‚                 - Tailwind CSS + Heroicons                          â”‚    â”‚
â”‚  â”‚                 - Inversify DI Container                            â”‚    â”‚
â”‚  â”‚                 - Axios HTTP Client                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ REST API (HTTP/HTTPS)
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           API GATEWAY LAYER                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         VT-AI-Lecture-Assistant-Backend_Java (Spring Boot)          â”‚    â”‚
â”‚  â”‚                 - Spring Boot 3.2 + Java 17                         â”‚    â”‚
â”‚  â”‚                 - Spring Security + JWT Auth                        â”‚    â”‚
â”‚  â”‚                 - Spring Data JPA (Hibernate)                       â”‚    â”‚
â”‚  â”‚                 - AWS SNS Client                                    â”‚    â”‚
â”‚  â”‚                 - Canvas LMS API Integration                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                     â”‚                              â”‚
          â”‚ HTTP               â”‚ SNS                          â”‚ HTTP
          â–¼                     â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚milvus-flask-qa-  â”‚  â”‚     AWS SNS      â”‚  â”‚       Canvas LMS API         â”‚
â”‚service (Python)  â”‚  â”‚  (FIFO Topics)   â”‚  â”‚     (External Service)       â”‚
â”‚ - Flask 3.0      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - AWS Bedrock    â”‚           â”‚
â”‚ - Milvus DB      â”‚           â”‚ SNS â†’ SQS Fan-out
â”‚ - Hybrid Search  â”‚           â–¼
â”‚ - Reranking      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  AWS SQS Queues                     â”‚
          â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                   â”‚                        â”‚
          â–¼                   â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Milvus DB      â”‚  â”‚ notes-generation-     â”‚  â”‚ vectorization-worker-milvus     â”‚
â”‚  (AWS ECS)       â”‚  â”‚ worker (Node.js)      â”‚  â”‚         (Python)                â”‚
â”‚ - Hybrid Search  â”‚  â”‚ - AWS Lambda          â”‚  â”‚ - AWS Lambda / ECS              â”‚
â”‚ - HNSW Index     â”‚  â”‚ - Bedrock Claude 3    â”‚  â”‚ - Bedrock Titan Embed v2        â”‚
â”‚ - BM25 Index     â”‚  â”‚ - PostgreSQL Client   â”‚  â”‚ - Milvus Client                 â”‚
â”‚ - EFS Storage    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ - PDF/DOCX Parsing              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                        â”‚
                              â–¼                        â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                    DATA LAYER                                â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
              â”‚  â”‚   PostgreSQL RDS   â”‚  â”‚      Milvus (AWS ECS)         â”‚  â”‚
              â”‚  â”‚   (ai_ta_db)       â”‚  â”‚   - Vector Embeddings         â”‚  â”‚
              â”‚  â”‚   - 18 Tables      â”‚  â”‚   - BM25 Sparse Vectors       â”‚  â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   - Course Partitioning       â”‚  â”‚
              â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 1.4 Architectural Style

The system employs a **Hybrid Microservices + Event-Driven Architecture**:

| Pattern | Where Applied |
|---------|---------------|
| **Microservices** | Separate services for user management (Java), QA (Python), notes generation (Node.js), vectorization (Python) |
| **Event-Driven** | SNS â†’ SQS fan-out pattern for async processing (notes generation, vectorization) |
| **API Gateway** | Java backend acts as gateway, proxying requests and orchestrating workflows |
| **CQRS-like** | Writes go to PostgreSQL; reads for QA use Milvus (hybrid semantic + keyword search) |

## 1.5 Major Components and Responsibilities

| Component | Responsibility |
|-----------|----------------|
| **VT-AI-Lecture-Assistant-Frontend** | User interface, authentication flow, course management UI, chat interface |
| **VT-AI-Lecture-Assistant-Backend_Java** | Authentication, authorization, Canvas API proxy, course/user management, SNS event publishing |
| **milvus-flask-qa-service** | AI-powered QA processing, hybrid vector search, reranking, tool execution (grades, TA notification) |
| **notes-generation-worker** | Transcript â†’ Structured Notes using Bedrock Claude 3 |
| **vectorization-worker-milvus-version** | Text chunking, embedding generation, vector storage in Milvus |
| **SQL-DB** | Schema documentation (PostgreSQL RDS) |

---

# ğŸ“Œ 2. Repository / Service Breakdown

## 2.1 VT-AI-Lecture-Assistant-Backend_Java

### Purpose & Responsibility
The Java backend is the **central API gateway** that handles:
- User authentication and session management
- Canvas LMS API integration (courses, enrollments, grades, modules)
- Course registration and context management
- Transcript upload and management
- SNS event publishing for async workflows
- QA request proxying to Flask service

### Tech Stack

| Category | Technology |
|----------|------------|
| **Language** | Java 17 |
| **Framework** | Spring Boot 3.2.0 |
| **Security** | Spring Security, JWT (jjwt 0.12.3) |
| **Database** | Spring Data JPA, Hibernate, PostgreSQL |
| **Build** | Maven |
| **AWS** | AWS SDK SNS 2.20.26 |
| **Utilities** | Lombok, Apache Commons Lang3 |

### Runtime Dependencies

| Dependency | Purpose |
|------------|---------|
| PostgreSQL RDS | Primary data storage |
| Canvas LMS API | External LMS integration |
| AWS SNS | Event publishing for async workers |
| Flask QA Service | AI-powered question answering |
| SMTP (Gmail) | Email notifications for disputes |

### Required Environment Variables

```properties
# Database
DB_USER, DB_PASSWORD

# JWT
JWT_SECRET (min 32 chars for HS256)

# Canvas LMS
CANVAS_DOMAIN, CANVAS_CLIENT_ID, CANVAS_CLIENT_SECRET
CANVAS_INSTRUCTOR_ACCESS_TOKEN, CANVAS_STUDENT_ACCESS_TOKEN

# AWS
AWS_REGION, AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY
AWS_SNS_TOPIC_ARN, AWS_SNS_VECTORIZATION_TOPIC_ARN

# QA Service
QA_SERVICE_URL

# Email
SMTP_SERVER, SMTP_PORT, SMTP_USERNAME, SMTP_PASSWORD
FROM_EMAIL, TA_EMAIL

# Development Auth
FAKE_INSTRUCTOR_EMAIL, FAKE_INSTRUCTOR_PASSWORD
FAKE_STUDENT_EMAIL, FAKE_STUDENT_PASSWORD
```

### Folder Structure

```
src/main/java/com/vt/ailecture/
â”œâ”€â”€ config/                    # Spring configuration classes
â”‚   â”œâ”€â”€ CacheConfig.java       # In-memory caching for Canvas API
â”‚   â”œâ”€â”€ DatabaseConfig.java    # JPA/Hibernate configuration
â”‚   â””â”€â”€ SecurityConfig.java    # Spring Security & JWT filter chain
â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ ClientController.java  # Main REST API (~1500 lines, 50+ endpoints)
â”‚   â””â”€â”€ AdminController.java   # Admin endpoints (cache, sessions)
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ canvas/               # Canvas API response DTOs (13 files)
â”‚   â”œâ”€â”€ request/              # API request DTOs (8 files)
â”‚   â””â”€â”€ response/             # API response DTOs (9 files)
â”œâ”€â”€ entity/                   # JPA entities (15 files)
â”œâ”€â”€ exception/                # Custom exception handlers
â”œâ”€â”€ repository/               # Spring Data JPA repositories (14 files)
â”œâ”€â”€ security/                 # JWT authentication (3 files)
â”œâ”€â”€ service/                  # Business logic (16 services)
â””â”€â”€ VtAiLectureApplication.java  # Main application entry
```

### Key Services

| Service | Purpose |
|---------|---------|
| `AuthService` | Login/logout, JWT generation, session management with token rotation |
| `CanvasService` | Canvas LMS API client with caching (users, courses, enrollments, grades) |
| `CourseService` | Course registration, student management |
| `TranscriptService` | Transcript upload, notes retrieval |
| `QaService` | Proxy to Flask QA service |
| `SnsService` | Event publishing for async workers |
| `QaDisputeService` | Dispute management and resolution |
| `EmailService` | Gmail SMTP email notifications |
| `GradeService` | Grade retrieval from Canvas |
| `QaLogService` | Analytics and logging |

### APIs Exposed

**Authentication:**
- `POST /api/auth/login` - Login with email/password
- `POST /api/auth/refresh` - Refresh access token
- `POST /api/auth/logout` - Logout and invalidate session
- `GET /api/auth/me` - Get current user info

**User Profile:**
- `GET /api/user/profile` - Comprehensive profile with Canvas data

**Course Management:**
- `POST /api/courses/register` - Register Canvas courses (instructor)
- `GET /api/courses/{id}/students` - Get course students (instructor)
- `POST /api/courses/context` - Set active course context
- `GET /api/courses/context` - Get current context
- `GET /api/courses/{id}/announcements` - Get announcements
- `GET /api/courses/{id}/modules` - Get modules
- `GET /api/courses/{id}/grades` - Get student grades

**Transcripts & Notes:**
- `POST /api/transcripts` - Upload transcript
- `GET /api/transcripts/course/{id}` - Get course transcripts
- `GET /api/notes/{id}` - Get notes by transcript

**QA System:**
- `POST /api/qa/ask` - Ask a question
- `GET /api/qa/history` - Student's question history
- `GET /api/analytics/qa` - QA analytics (instructor)
- `POST /api/qa/dispute` - Submit dispute (student)
- `GET /api/disputes` - Get disputes (instructor)
- `POST /api/disputes/resolve` - Resolve dispute (instructor)

**Health:**
- `GET /api/health` - Service health check

---

## 2.2 VT-AI-Lecture-Assistant-Frontend

### Purpose & Responsibility
A **React single-page application (SPA)** providing the user interface for:
- Student and instructor authentication
- Course selection and context management
- AI-powered chat interface for QA
- Lecture browsing and notes viewing
- Grade viewing
- Analytics dashboard (instructors)
- Dispute submission and resolution

### Tech Stack

| Category | Technology |
|----------|------------|
| **Language** | TypeScript 4.9.5 |
| **Framework** | React 18.2.0 |
| **Routing** | React Router DOM 6.8.1 |
| **HTTP Client** | Axios 1.6.0 |
| **Dependency Injection** | Inversify 6.0.1 |
| **Styling** | Tailwind CSS 3.4.17 |
| **Icons** | Heroicons 2.0.16, Lucide React 0.553.0 |
| **Charts** | Recharts 3.5.0 |
| **Build** | Create React App (react-scripts 5.0.1) |

### Required Environment Variables

```
REACT_APP_API_BASE_URL=http://localhost:3167/api
REACT_APP_API_TIMEOUT=10000
```

### Key Features by Page

| Page | Functionality | Access |
|------|--------------|--------|
| `Landing` | Public landing page | Public |
| `Login` | Email/password authentication | Public |
| `Home` | Dashboard with course selection | Authenticated |
| `Chat` | AI-powered QA chat interface | Authenticated |
| `Lectures` | List of course transcripts | Authenticated |
| `LectureNotes` | View generated notes | Authenticated |
| `Grades` | View Canvas grades | Authenticated |
| `History` | Student's question history | Student only |
| `Analytics` | QA usage statistics | Instructor only |
| `Disputes` | Dispute management | Instructor only |
| `InstructorUpload` | Upload transcripts | Instructor only |
| `Profile` | User profile & course registration | Authenticated |

---

## 2.3 milvus-flask-qa-service

### Purpose & Responsibility
The **AI-powered Question Answering service** that:
- Processes natural language questions
- Performs **hybrid search** using Milvus (semantic + BM25 keyword search)
- **Reranks** results using AWS Bedrock Amazon Rerank v1
- Generates answers using AWS Bedrock (Llama 3.3 70B)
- Executes tools (grade lookup, TA notification)
- Supports role-based tool access

### Tech Stack

| Category | Technology |
|----------|------------|
| **Language** | Python 3.11 |
| **Framework** | Flask 3.0.0 |
| **AWS** | Boto3, Bedrock Runtime |
| **Vector DB** | Milvus 2.5.0 (pymilvus) |
| **Validation** | Pydantic 2.5.0 |
| **Auth** | PyJWT 2.8.0 |
| **HTTP** | Requests 2.31.0 |
| **Server** | Gunicorn 21.2.0 |

### Required Environment Variables

```bash
# Milvus Configuration
MILVUS_URI=http://milvus-nlb-...:19530
COLLECTION_NAME=lecture_assistant_vectors

# AWS Configuration
BEDROCK_REGION=us-east-1

# Model Configuration
EMBED_MODEL=amazon.titan-embed-text-v2:0
TEXT_MODEL=us.meta.llama3-3-70b-instruct-v1:0
RERANKER_MODEL=amazon.rerank-v1:0
RERANKER_REGION=us-west-2

# Search Configuration
INITIAL_RETRIEVAL_K=50
TOP_K=10

# Authentication
JWT_SECRET             # Shared with Java backend
REQUIRE_AUTH=true

# Grade API
GRADE_API_URL          # Java backend URL
ENABLE_GRADE_TOOL=true
ENABLE_INSTRUCTOR_GRADE_TOOL=true

# Email (for TA notifications)
SMTP_SERVER, SMTP_PORT, SMTP_USERNAME, SMTP_PASSWORD
FROM_EMAIL, TA_EMAIL
ENABLE_TA_EMAIL_NOTIFICATION=true
```

### API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/health` | Health check |
| `GET` | `/models` | List available Bedrock models |
| `POST` | `/ask` | Process QA question |
| `GET` | `/ask` | Process QA question (query params) |

### Core QA Flow (with Milvus)

1. **Authenticate** - Validate JWT token from Java backend
2. **Embed Query** - Generate vector embedding using Titan Embed v2
3. **Hybrid Search** - Query Milvus with:
   - Dense vector search (70% weight)
   - BM25 sparse vector search (30% weight)
4. **Rerank** - Use Amazon Rerank v1 to reorder top 50 â†’ top 10
5. **Build Context** - Assemble reranked chunks with source metadata
6. **Check Tools** - Determine if LLM needs tool calling
7. **Generate Answer** - Use Llama 3.3 70B to synthesize answer
8. **Execute Tools** - If needed (grades, TA notification)
9. **Return Response** - Formatted answer with sources

### LLM Tools

| Tool | Availability | Purpose |
|------|--------------|---------|
| `get_student_grade` | Students | Retrieve grades for authenticated student |
| `get_student_roster` | Instructors | Get course roster |
| `get_student_grade_by_id` | Instructors | Get grades for specific student |
| `notify_ta` | All | Send TA email when AI can't answer |

---

## 2.4 vectorization-worker-milvus-version

### Purpose & Responsibility
An **AWS Lambda/ECS function** that:
- Processes SQS events for content vectorization
- Extracts text from various sources (notes, syllabus, assignments, announcements, modules)
- Chunks text with overlap for semantic coherence
- Generates dense embeddings using AWS Bedrock Titan v2
- Stores vectors in Milvus with BM25 function for hybrid search

### Tech Stack

| Category | Technology |
|----------|------------|
| **Language** | Python 3.11 |
| **Runtime** | AWS Lambda / ECS |
| **AWS** | Boto3 (Bedrock), psycopg2 |
| **Vector DB** | Milvus 2.5.0 (pymilvus) |
| **Text Processing** | BeautifulSoup4, pdfplumber, python-docx |
| **Build** | Docker, SAM CLI |

### Required Environment Variables

```bash
MILVUS_URI                # Milvus endpoint
COLLECTION_NAME=lecture_assistant_vectors
DATABASE_URL              # PostgreSQL connection string
EMBED_MODEL=amazon.titan-embed-text-v2:0
AWS_REGION=us-east-1

# Text chunking
CHUNK_SIZE_WORDS=250      # Words per chunk
CHUNK_OVERLAP_WORDS=50    # Overlap words
MIN_CHUNK_SIZE_WORDS=200  # Minimum chunk size

# Canvas API (for module processing)
CANVAS_DOMAIN
CANVAS_INSTRUCTOR_TOKEN
```

### Event Types Handled

| Type | Payload | Processing |
|------|---------|------------|
| `notes` | `{type: "notes", id: 123}` | Fetch note text, chunk, embed, store in Milvus |
| `syllabus` | `{type: "syllabus", id: 123}` | Parse HTML, chunk, embed, store |
| `assignment` | `{type: "assignment", id: 123}` | Parse description, add due date, embed |
| `announcement` | `{type: "announcement", id: 123}` | Parse HTML content, embed |
| `modules` | `{type: "modules", courseId: 1, moduleIds: [...]}` | Fetch from Canvas, extract Files/Pages |
| `pages` | `{type: "pages", courseId: 1, pageIds: [...]}` | Fetch page content, parse HTML |

### Vector Storage (Milvus)

Vectors stored with metadata in Milvus collection:
```python
Collection Schema:
â”œâ”€â”€ vector_id (INT64, Primary Key, Auto-generated)
â”œâ”€â”€ embedding (FLOAT_VECTOR, dim=1024)
â”œâ”€â”€ sparse_vector (SPARSE_FLOAT_VECTOR, BM25 output)
â”œâ”€â”€ course_id (INT64, Partition Key)
â”œâ”€â”€ source (VARCHAR, max=50)
â”œâ”€â”€ source_id (INT64)
â”œâ”€â”€ chunk_index (INT32)
â”œâ”€â”€ chunk_text_preview (VARCHAR, max=500)
â”œâ”€â”€ chunk_text_full (VARCHAR, max=8000)
â”œâ”€â”€ timestamp (INT64)
â””â”€â”€ metadata_json (JSON)
```

---

## 2.5 notes-generation-worker

### Purpose & Responsibility
An **AWS Lambda function** that:
- Consumes transcript events from SQS
- Generates structured lecture notes using Claude 3 Sonnet
- Saves notes to PostgreSQL database
- Triggers vectorization for generated notes

### Tech Stack

| Category | Technology |
|----------|------------|
| **Language** | JavaScript (Node.js 20+, ES Modules) |
| **Runtime** | AWS Lambda |
| **AWS** | @aws-sdk/client-bedrock-runtime, @aws-sdk/client-sns |
| **Database** | pg (PostgreSQL client) |
| **Validation** | Zod 4.1.12 |

### Required Environment Variables

```bash
DATABASE_URL              # PostgreSQL connection string
BEDROCK_REGION=us-east-1
BEDROCK_MODEL_ID=anthropic.claude-3-sonnet-20240229-v1:0
SNS_TOPIC_ARN             # For vectorization events
```

### Processing Flow

1. Receive SQS event with transcript ID
2. Check if notes already exist (idempotency)
3. Fetch transcript from database
4. Generate notes using Bedrock Claude 3
5. Save notes to `notes` table
6. Publish SNS event to trigger vectorization

---

# ğŸ“Œ 3. RAG Architecture (Milvus)

## 3.1 System Overview

The RAG system consists of three core components working together:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VT AI Lecture Assistant RAG                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                  â”‚    â”‚                  â”‚    â”‚                  â”‚       â”‚
â”‚  â”‚  Vectorization   â”‚â”€â”€â”€â–¶â”‚    Milvus DB     â”‚â—€â”€â”€â”€â”‚   QA Service     â”‚       â”‚
â”‚  â”‚     Worker       â”‚    â”‚                  â”‚    â”‚                  â”‚       â”‚
â”‚  â”‚                  â”‚    â”‚                  â”‚    â”‚                  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                        â”‚                        â”‚                  â”‚
â”‚         â–¼                        â–¼                        â–¼                  â”‚
â”‚   Ingestion &              Vector Storage           Retrieval &              â”‚
â”‚   Embedding                & Indexing              Generation                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Purpose of Each Component

| Component | Responsibility |
|-----------|----------------|
| **Vectorization Worker** | Processes course content (notes, syllabus, assignments, announcements, modules) into vector embeddings and stores them in Milvus |
| **Milvus DB** | Stores and indexes vector embeddings, supports hybrid search (semantic + keyword) |
| **QA Service** | Receives user questions, retrieves relevant context via hybrid search, reranks results, and generates answers using LLM |

## 3.2 Technology Stack

### AI/ML Models

| Model | Provider | Model ID | Purpose | Dimensions |
|-------|----------|----------|---------|------------|
| **Titan Embed Text v2** | AWS Bedrock | `amazon.titan-embed-text-v2:0` | Text embeddings | 1024 |
| **Llama 3.3 70B Instruct** | AWS Bedrock | `us.meta.llama3-3-70b-instruct-v1:0` | Answer generation | - |
| **Amazon Rerank v1** | AWS Bedrock | `amazon.rerank-v1:0` | Result reranking | - |

### Vector Database

| Setting | Value | Reason |
|---------|-------|--------|
| **Database** | Milvus 2.5.0 | Open-source, supports hybrid search |
| **Deployment** | Standalone (embedded etcd) | Simplicity, sufficient for workload |
| **Index Type** | HNSW | Best balance of speed and accuracy |
| **Distance Metric** | COSINE | Standard for text embeddings |
| **BM25** | Built-in function | Keyword matching for hybrid search |

## 3.3 Milvus Collection Schema

### Collection: `lecture_assistant_vectors`

```python
Collection Schema:
â”œâ”€â”€ vector_id (INT64, Primary Key, Auto-generated)
â”œâ”€â”€ embedding (FLOAT_VECTOR, dim=1024)
â”œâ”€â”€ sparse_vector (SPARSE_FLOAT_VECTOR, BM25 output)
â”œâ”€â”€ course_id (INT64, Partition Key)
â”œâ”€â”€ source (VARCHAR, max=50)
â”œâ”€â”€ source_id (INT64)
â”œâ”€â”€ chunk_index (INT32)
â”œâ”€â”€ chunk_text_preview (VARCHAR, max=500)
â”œâ”€â”€ chunk_text_full (VARCHAR, max=8000)
â”œâ”€â”€ timestamp (INT64)
â””â”€â”€ metadata_json (JSON)
```

### Indexes

| Index | Field | Type | Configuration |
|-------|-------|------|---------------|
| **Dense Index** | `embedding` | HNSW | `M=16, efConstruction=200, metric=COSINE` |
| **Sparse Index** | `sparse_vector` | SPARSE_INVERTED_INDEX | `metric=BM25, drop_ratio_build=0.2` |

### Partitioning Strategy

**Partition Key:** `course_id`

Each course has its own partition named `course_{id}`:

```
Collection: lecture_assistant_vectors
â”œâ”€â”€ Partition: course_1
â”‚   â”œâ”€â”€ notes vectors
â”‚   â”œâ”€â”€ syllabus vectors
â”‚   â”œâ”€â”€ assignment vectors
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Partition: course_2
â”‚   â””â”€â”€ ...
â””â”€â”€ Partition: course_N
    â””â”€â”€ ...
```

**Benefits:**
- **Query Isolation:** Queries only search within the relevant course partition
- **Performance:** Smaller search space per query
- **Data Management:** Easy to delete/re-vectorize a specific course

## 3.4 Chunking Strategy

### Configuration Parameters

| Parameter | Default Value | Description |
|-----------|---------------|-------------|
| **Chunk Size** | 250 words | Target words per chunk |
| **Chunk Overlap** | 50 words | Words shared between adjacent chunks |
| **Min Chunk Size** | 200 words | Minimum words; smaller chunks are merged |
| **Preview Length** | 500 chars | Stored for display/citation |
| **Full Text Length** | 8000 chars | Stored for BM25 indexing |

### Chunking Algorithm

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Chunking Process                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  Input Document (e.g., Lecture Notes)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Word1 Word2 Word3 ... Word250 Word251 ... Word500 Word501   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Chunking Module                           â”‚    â”‚
â”‚  â”‚  â€¢ Split by sentences (preserve sentence boundaries)         â”‚    â”‚
â”‚  â”‚  â€¢ Target: 250 words per chunk                               â”‚    â”‚
â”‚  â”‚  â€¢ Overlap: 50 words between chunks                          â”‚    â”‚
â”‚  â”‚  â€¢ Minimum: 200 words (merge small chunks)                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  Output Chunks:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Chunk 0    â”‚  â”‚   Chunk 1    â”‚  â”‚   Chunk 2    â”‚              â”‚
â”‚  â”‚  Words 1-250 â”‚  â”‚ Words 200-450â”‚  â”‚ Words 400-650â”‚              â”‚
â”‚  â”‚              â”‚  â”‚   (overlap)  â”‚  â”‚   (overlap)  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3.5 Hybrid Search & Retrieval

### Hybrid Search Overview

The system combines two search methods for optimal retrieval:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Hybrid Search                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  User Query: "What is the deadline for the PDF assignment?"         â”‚
â”‚         â”‚                                                            â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚         â”‚                     â”‚                                 â”‚    â”‚
â”‚         â–¼                     â–¼                                 â”‚    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚    â”‚
â”‚  â”‚   Semantic   â”‚      â”‚   Keyword    â”‚                        â”‚    â”‚
â”‚  â”‚   Search     â”‚      â”‚   Search     â”‚                        â”‚    â”‚
â”‚  â”‚   (Dense)    â”‚      â”‚   (BM25)     â”‚                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚    â”‚
â”‚         â”‚                     â”‚                                 â”‚    â”‚
â”‚         â”‚  Query Vector       â”‚  Query Text                     â”‚    â”‚
â”‚         â”‚  [0.02, -0.15...]   â”‚  "deadline PDF assignment"      â”‚    â”‚
â”‚         â”‚                     â”‚                                 â”‚    â”‚
â”‚         â–¼                     â–¼                                 â”‚    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚                    Milvus hybrid_search()                 â”‚  â”‚    â”‚
â”‚  â”‚  â€¢ AnnSearchRequest(embedding, COSINE)                    â”‚  â”‚    â”‚
â”‚  â”‚  â€¢ AnnSearchRequest(sparse_vector, BM25)                  â”‚  â”‚    â”‚
â”‚  â”‚  â€¢ WeightedRanker(0.7, 0.3)                               â”‚  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚         â”‚                                                       â”‚    â”‚
â”‚         â–¼                                                       â”‚    â”‚
â”‚  Combined Results (ranked by weighted score)                    â”‚    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Search Weights

| Search Type | Weight | Rationale |
|-------------|--------|-----------|
| **Semantic (Dense)** | 0.7 (70%) | Primary method; captures meaning and context |
| **Keyword (BM25)** | 0.3 (30%) | Supplements with exact term matching |

**Why 70/30?**
- Semantic search excels at understanding intent ("assignment about chunking" â†’ "PDF processing homework")
- BM25 catches exact terms that semantic might miss ("Assignment 1", specific dates, names)
- 70/30 prioritizes meaning while still benefiting from keyword precision

### Search Parameters

| Parameter | Value |
|-----------|-------|
| **Initial Retrieval K** | 50 |
| **Final Top K** | 10 |
| **HNSW ef** | 64 |
| **Partition Filter** | `course_{id}` |
| **Source Filter** | `notes, syllabus, assignment, announcement, module_item, page` |

## 3.6 Reranking Strategy

After initial retrieval, results are reranked using a cross-encoder model for improved relevance.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Reranking Pipeline                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  Initial Results (50 chunks from hybrid search)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Chunk 1 (score: 0.89), Chunk 2 (score: 0.82), ..., Chunk 50  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                                            â”‚
â”‚         â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    AWS Bedrock Reranker                       â”‚   â”‚
â”‚  â”‚  Model: amazon.rerank-v1:0                                    â”‚   â”‚
â”‚  â”‚  Region: us-west-2                                            â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  For each (query, chunk) pair:                                â”‚   â”‚
â”‚  â”‚  â€¢ Compute relevance score using cross-encoder               â”‚   â”‚
â”‚  â”‚  â€¢ Score considers query-document interaction                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                                            â”‚
â”‚         â–¼                                                            â”‚
â”‚  Reranked Results (top 10, sorted by reranker score)                â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why Reranking?

| Without Reranking | With Reranking |
|-------------------|----------------|
| Bi-encoder scores (query and doc encoded separately) | Cross-encoder scores (query-doc interaction) |
| Fast but less precise | Slower but more accurate |
| Good for initial retrieval | Excellent for final ranking |
| May miss subtle relevance | Captures nuanced relevance |

## 3.7 Answer Generation

### LLM Configuration

| Setting | Value |
|---------|-------|
| **Model** | Llama 3.3 70B Instruct |
| **Model ID** | `us.meta.llama3-3-70b-instruct-v1:0` |
| **Region** | us-east-1 |
| **Max Tokens** | 400 |
| **Temperature** | 0.3 |

### Prompt Template

```
You are an AI Teaching Assistant for a university course. Answer the student's question based ONLY on the provided course materials.

COURSE MATERIALS:
{context}

STUDENT QUESTION: {question}

INSTRUCTIONS:
- Answer based ONLY on the provided materials
- If the answer is not in the materials, say "I don't have information about that in the course materials"
- Be concise and helpful
- Cite sources when possible

ANSWER:
```

## 3.8 Question Answering Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Question Answering Flow                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  1. User Asks Question                                                       â”‚
â”‚     "What is the deadline for Assignment 1?"                                â”‚
â”‚              â”‚                                                               â”‚
â”‚              â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  React Frontend  â”‚ â”€â”€â”€â”€â”€â”€â–¶ â”‚   Java Backend   â”‚                          â”‚
â”‚  â”‚                  â”‚   JWT   â”‚  /api/qa/ask     â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                        â”‚                                     â”‚
â”‚                                        â–¼                                     â”‚
â”‚  2. QA Service Processing                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         QA Service (Flask)                            â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Step 1: Generate Query Embedding                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚         Bedrock Titan v2 â†’ [0.02, -0.15, ...]                   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                              â”‚                                        â”‚   â”‚
â”‚  â”‚                              â–¼                                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Step 2: Hybrid Search (Milvus)                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚         Dense (70%) + BM25 (30%) â†’ 50 candidates                â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                              â”‚                                        â”‚   â”‚
â”‚  â”‚                              â–¼                                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Step 3: Rerank (Bedrock Amazon Rerank v1)                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚         50 candidates â†’ top 10 reranked                         â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                              â”‚                                        â”‚   â”‚
â”‚  â”‚                              â–¼                                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Step 4: Generate Answer (Bedrock Llama 3.3 70B)                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚         Context + Question â†’ Answer                             â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                        â”‚                                     â”‚
â”‚                                        â–¼                                     â”‚
â”‚  3. Response to User                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  {                                                                    â”‚   â”‚
â”‚  â”‚    "answer": "The deadline for Assignment 1 is February 15, 2026.",  â”‚   â”‚
â”‚  â”‚    "sources": [                                                       â”‚   â”‚
â”‚  â”‚      {"type": "syllabus", "id": 1, "preview": "...deadline..."},     â”‚   â”‚
â”‚  â”‚      {"type": "assignment", "id": 42, "preview": "..."}              â”‚   â”‚
â”‚  â”‚    ],                                                                 â”‚   â”‚
â”‚  â”‚    "confidence": 0.92                                                 â”‚   â”‚
â”‚  â”‚  }                                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3.9 Deployment Architecture

### AWS Infrastructure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AWS Account                                     â”‚
â”‚                            (us-east-2 / Ohio)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                        VPC: vt-ai-ta-vpc                            â”‚     â”‚
â”‚  â”‚                      (10.0.0.0/16)                                  â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚     â”‚
â”‚  â”‚  â”‚    Public Subnets       â”‚  â”‚    Private Subnets      â”‚          â”‚     â”‚
â”‚  â”‚  â”‚                         â”‚  â”‚                         â”‚          â”‚     â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚          â”‚     â”‚
â”‚  â”‚  â”‚  â”‚  ALB (Frontend) â”‚    â”‚  â”‚  â”‚  Milvus (ECS)   â”‚    â”‚          â”‚     â”‚
â”‚  â”‚  â”‚  â”‚  ALB (Backend)  â”‚    â”‚  â”‚  â”‚  Port: 19530    â”‚    â”‚          â”‚     â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚          â”‚     â”‚
â”‚  â”‚  â”‚                         â”‚  â”‚                         â”‚          â”‚     â”‚
â”‚  â”‚  â”‚                         â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚          â”‚     â”‚
â”‚  â”‚  â”‚                         â”‚  â”‚  â”‚  QA Service     â”‚    â”‚          â”‚     â”‚
â”‚  â”‚  â”‚                         â”‚  â”‚  â”‚  (ECS Fargate)  â”‚    â”‚          â”‚     â”‚
â”‚  â”‚  â”‚                         â”‚  â”‚  â”‚  Port: 5000     â”‚    â”‚          â”‚     â”‚
â”‚  â”‚  â”‚                         â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚          â”‚     â”‚
â”‚  â”‚  â”‚                         â”‚  â”‚                         â”‚          â”‚     â”‚
â”‚  â”‚  â”‚                         â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚          â”‚     â”‚
â”‚  â”‚  â”‚                         â”‚  â”‚  â”‚  RDS PostgreSQL â”‚    â”‚          â”‚     â”‚
â”‚  â”‚  â”‚                         â”‚  â”‚  â”‚  Port: 5432     â”‚    â”‚          â”‚     â”‚
â”‚  â”‚  â”‚                         â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚          â”‚     â”‚
â”‚  â”‚  â”‚                         â”‚  â”‚                         â”‚          â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚     â”‚
â”‚  â”‚                                                                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Lambda         â”‚  â”‚  EFS            â”‚  â”‚  SQS            â”‚             â”‚
â”‚  â”‚  (Vectorization â”‚  â”‚  (Milvus Data)  â”‚  â”‚  (Event Queue)  â”‚             â”‚
â”‚  â”‚   Worker)       â”‚  â”‚                 â”‚  â”‚                 â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ECS Services

| Service | Task Definition | CPU | Memory | Storage |
|---------|-----------------|-----|--------|---------|
| **milvus-standalone** | `milvus-standalone:4` | 1024 | 2048 MB | EFS (persistent) |
| **vt-ai-ta-milvus-qa-service** | `vt-ai-ta-milvus-qa-service:17` | 512 | 1024 MB | Ephemeral |
| **milvus-vectorization-worker** | Lambda | 1024 | 512 MB | Ephemeral |

---

# ğŸ“Œ 4. Component Interaction & Communication

## 4.1 Service Communication Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTP/REST      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Java Backend   â”‚
â”‚   (React)    â”‚   JSON over HTTPS  â”‚  (Spring Boot)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                        â”‚                        â”‚
                    â–¼                        â–¼                        â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Flask QA       â”‚      â”‚   Canvas LMS    â”‚      â”‚   PostgreSQL  â”‚
           â”‚ Service        â”‚      â”‚   (External)    â”‚      â”‚   (RDS)       â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   Milvus DB    â”‚
           â”‚ (Hybrid Search)â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                        â”‚                        â”‚
                    â–¼                        â–¼                        â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   AWS Bedrock  â”‚      â”‚   AWS SNS       â”‚      â”‚   AWS EFS     â”‚
           â”‚ (Embed/LLM/    â”‚      â”‚  (FIFO Topic)   â”‚      â”‚ (Milvus Data) â”‚
           â”‚  Rerank)       â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                                  SNS â†’ SQS Fan-out
                                           â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚                                        â”‚
                          â–¼                                        â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Notes Generation â”‚                   â”‚ Vectorization    â”‚
                 â”‚ Worker (Lambda)  â”‚                   â”‚ Worker (Lambda)  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4.2 API Calls Between Services

### Frontend â†’ Java Backend

| Flow | Request | Response |
|------|---------|----------|
| Login | `POST /api/auth/login {email, password}` | `{accessToken, user}` |
| Get Profile | `GET /api/user/profile` | `{user, canvasEnrollments, registeredCourses}` |
| Ask Question | `POST /api/qa/ask {question, courseId}` | `{answer, sources, model_used}` |
| Get Grades | `GET /api/courses/{id}/students/{id}/grades` | `[{assignment, score, grade}]` |

### Java Backend â†’ Flask QA Service

| Endpoint | Purpose |
|----------|---------|
| `POST /ask` | Forward QA request with JWT |

Request:
```json
{
  "question": "What is the due date for homework 2?",
  "course_id": "123",
  "include_hits": false
}
```

Headers:
```
Authorization: Bearer <forwarded-jwt>
```

Response:
```json
{
  "answer": "Homework 2 is due on December 15, 2025...",
  "sources": [
    {"type": "syllabus", "id": 1, "preview": "..."},
    {"type": "assignment", "id": 42, "preview": "..."}
  ],
  "model_used": "us.meta.llama3-3-70b-instruct-v1:0"
}
```

### Java Backend â†’ AWS SNS

Events published for async processing:

```java
// Transcript uploaded â†’ Notes generation
publishTranscriptNotification(transcriptId);
// Publishes: {"type":"transcript","id":123}

// Syllabus synced â†’ Vectorization
publishSyllabusNotification(syllabusId);
// Publishes: {"type":"syllabus","id":456}

// Assignments synced â†’ Vectorization
publishAssignmentNotification(assignmentId);

// Modules synced â†’ Vectorization
publishModulesNotification(courseId, moduleIds);
// Publishes: {"type":"modules","courseId":1,"moduleIds":[1,2,3]}
```

## 4.3 Content Vectorization Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Content Vectorization Flow                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  1. Content Created/Updated                                                  â”‚
â”‚     (Backend saves to PostgreSQL)                                           â”‚
â”‚              â”‚                                                               â”‚
â”‚              â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚  Java Backend    â”‚ â”€â”€â”€ publishes â”€â”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  SNS Publisher   â”‚                    â”‚   SNS Topic      â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ (vectorization)  â”‚               â”‚
â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                   â”‚                          â”‚
â”‚                                                   â–¼                          â”‚
â”‚                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                                          â”‚   SQS Queue      â”‚               â”‚
â”‚                                          â”‚                  â”‚               â”‚
â”‚                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                   â”‚                          â”‚
â”‚                                                   â–¼                          â”‚
â”‚  2. Worker Processes Event                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Vectorization Worker                               â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Receive â”‚â”€â”€â–¶â”‚  Fetch  â”‚â”€â”€â–¶â”‚  Chunk  â”‚â”€â”€â–¶â”‚  Embed  â”‚â”€â”€â–¶â”‚  Store  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Event  â”‚   â”‚ Content â”‚   â”‚  Text   â”‚   â”‚ Vectors â”‚   â”‚ Milvus  â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚       â”‚             â”‚             â”‚             â”‚             â”‚       â”‚   â”‚
â”‚  â”‚       â”‚        PostgreSQL    Chunking      Bedrock       Milvus      â”‚   â”‚
â”‚  â”‚       â”‚                       Module       Titan v2       API        â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  3. Vectors Stored in Milvus                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Collection: lecture_assistant_vectors                                â”‚   â”‚
â”‚  â”‚  Partition: course_{id}                                               â”‚   â”‚
â”‚  â”‚  Vectors: [embedding, sparse_vector, metadata...]                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# ğŸ“Œ 5. Features Breakdown

## 5.1 User Authentication

**Description:** Secure login/logout with JWT tokens and session management

**Services:** Frontend, Java Backend

**Flow:**
1. User enters email/password
2. Backend validates credentials (fake auth for development)
3. Backend creates/finds user in database
4. Backend generates JWT access token (15 min) + refresh token (7 days)
5. Access token stored in memory, refresh token in HTTP-only cookie
6. On expiry, automatic refresh with token rotation

**APIs:**
- `POST /api/auth/login`
- `POST /api/auth/refresh`
- `POST /api/auth/logout`
- `GET /api/auth/me`

**DB Tables:** `students`, `instructors`, `user_sessions`, `external_mappings`

## 5.2 Course Registration

**Description:** Instructors register Canvas courses to the system

**Services:** Frontend, Java Backend, Canvas LMS

**Flow:**
1. Instructor views profile with Canvas enrollments
2. Selects courses to register
3. Backend creates course records
4. Backend syncs students from Canvas
5. Backend syncs syllabus, assignments, announcements
6. Backend publishes SNS events for vectorization

**APIs:**
- `GET /api/user/profile` (includes Canvas enrollments)
- `POST /api/courses/register`

**DB Tables:** `courses`, `enrollments`, `syllabus`, `assignments`, `announcements`

## 5.3 AI-Powered Question Answering

**Description:** Students ask questions, receive AI-generated answers from course materials

**Services:** Frontend, Java Backend, Flask QA Service, Milvus, Bedrock

**Flow:**
1. Student types question in chat
2. Backend forwards to Flask QA
3. QA service embeds question with Titan v2
4. QA service performs hybrid search in Milvus (semantic + BM25)
5. QA service reranks results with Amazon Rerank v1
6. QA service generates answer with Llama 3.3 70B
7. Answer displayed with markdown formatting and sources

**APIs:**
- `POST /api/qa/ask`

**DB Tables:** `qa_logs`

**Business Logic:**
- Hybrid search across notes, syllabus, assignments, announcements, modules
- 70% semantic + 30% BM25 keyword weighting
- Reranking for improved precision
- Role-based tool access (students: grades, instructors: roster)
- Automatic TA notification on low confidence

## 5.4 Lecture Notes Generation

**Description:** Automatic generation of structured notes from lecture transcripts

**Services:** Java Backend, Notes Generation Worker, Bedrock

**Flow:**
1. Instructor uploads transcript text
2. Backend saves to database
3. Backend publishes SNS event
4. Lambda processes transcript with Claude 3
5. Lambda saves generated notes
6. Lambda triggers vectorization to Milvus

**APIs:**
- `POST /api/transcripts`
- `GET /api/transcripts/course/{id}`
- `GET /api/notes/{id}`

**DB Tables:** `transcripts`, `notes`

## 5.5 Grade Viewing

**Description:** Students view their grades from Canvas

**Services:** Frontend, Java Backend, Canvas LMS, Flask QA Service

**Flow (via Chat):**
1. Student asks "What is my grade on homework 2?"
2. QA service detects grade intent
3. QA service calls grade tool
4. Tool fetches grades from Java backend
5. Java backend fetches from Canvas API
6. Formatted response returned to student

**Flow (via Grades page):**
1. Student navigates to Grades page
2. Frontend fetches grades from backend
3. Backend fetches from Canvas API
4. Grades displayed in table

**APIs:**
- `GET /api/courses/{id}/students/{studentId}/grades`

## 5.6 QA Analytics

**Description:** Instructors view question statistics and student engagement

**Services:** Frontend, Java Backend

**Flow:**
1. Instructor navigates to Analytics
2. Backend queries qa_logs for course
3. Returns daily counts, student breakdowns
4. Frontend displays charts (Recharts)

**APIs:**
- `GET /api/analytics/qa`
- `GET /api/analytics/qa/student/{studentId}`

**DB Tables:** `qa_logs`

## 5.7 Dispute Resolution

**Description:** Students dispute AI answers, instructors provide corrections

**Services:** Frontend, Java Backend, Email Service

**Flow (Student):**
1. Student marks answer as wrong
2. Student submits dispute with expected answer
3. Backend saves dispute
4. TA notified via email

**Flow (Instructor):**
1. Instructor views disputes
2. Instructor provides solution
3. Backend saves resolution
4. Student notified via email

**APIs:**
- `POST /api/qa/dispute`
- `GET /api/disputes`
- `POST /api/disputes/resolve`

**DB Tables:** `qa_disputes`, `qa_logs`

---

# ğŸ“Œ 6. Security Model

## 6.1 Authentication

### Mechanism: JWT (JSON Web Tokens)

**Implementation:**
- Algorithm: **HMAC-SHA256** (HS256)
- Library: `io.jsonwebtoken:jjwt` (Java), `PyJWT` (Python)
- Secret: Shared via `JWT_SECRET` environment variable

**Token Structure:**
```json
{
  "sub": "instructor-1",
  "userType": "instructor",
  "entityId": 1,
  "email": "instructor@vt.edu",
  "name": "John Doe",
  "iss": "vt-ai-lecture-assistant",
  "aud": "vt-ai-frontend",
  "iat": 1733500000,
  "exp": 1733500900
}
```

**Token Types:**
| Type | Expiry | Storage | Purpose |
|------|--------|---------|---------|
| Access Token | 15 minutes | In-memory (JS) | API authentication |
| Refresh Token | 7 days | HTTP-only cookie | Token renewal |

### Session Management

- Sessions stored in `user_sessions` table
- Refresh token **hashed** with BCrypt before storage
- Token rotation on each refresh (old token invalidated)
- Automatic cleanup of expired sessions (scheduled task)

## 6.2 Authorization

### Role-Based Access Control (RBAC)

**Roles:**
| Role | Access Level |
|------|--------------|
| `student` | View own grades, ask questions, view transcripts, submit disputes |
| `instructor` | All student access + course management, analytics, dispute resolution |

### Endpoint Authorization Matrix

| Endpoint | Student | Instructor |
|----------|---------|------------|
| `POST /api/qa/ask` | âœ“ | âœ“ |
| `GET /api/courses/{id}/grades` | Own only | Any student |
| `GET /api/analytics/qa` | âœ— | âœ“ |
| `POST /api/disputes/resolve` | âœ— | âœ“ |
| `POST /api/courses/register` | âœ— | âœ“ |

---

# ğŸ“Œ 7. System Architecture

## 7.1 High-Level Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    USERS                                         â”‚
â”‚                     Students & Instructors (Virginia Tech)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚ HTTPS
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PRESENTATION LAYER                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    React SPA (vt-ai-lecture-assistant)                       â”‚  â”‚
â”‚  â”‚  â€¢ React 18 + TypeScript      â€¢ Tailwind CSS                                 â”‚  â”‚
â”‚  â”‚  â€¢ React Router 6             â€¢ Recharts (Analytics)                         â”‚  â”‚
â”‚  â”‚  â€¢ Inversify DI               â€¢ Axios HTTP Client                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚ REST API (Port 3167)
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              APPLICATION LAYER                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                Spring Boot Backend (API Gateway)                             â”‚  â”‚
â”‚  â”‚  â€¢ Spring Security + JWT Authentication                                      â”‚  â”‚
â”‚  â”‚  â€¢ Spring Data JPA (Hibernate)                                               â”‚  â”‚
â”‚  â”‚  â€¢ Canvas LMS API Integration (REST Template)                                â”‚  â”‚
â”‚  â”‚  â€¢ AWS SNS Client (Event Publishing)                                         â”‚  â”‚
â”‚  â”‚  â€¢ In-Memory Caching (ConcurrentMapCacheManager)                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                     â”‚                                          â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚  â”‚                    Flask QA Service (AI Layer)                           â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â€¢ Hybrid Search (Milvus: Dense + BM25)                                  â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â€¢ Reranking (Amazon Rerank v1)                                          â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â€¢ LLM Integration (Bedrock Llama 3.3 70B)                               â”‚  â”‚â”‚
â”‚  â”‚  â”‚  â€¢ Tool Calling (Grades, TA Notification)                                â”‚  â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                         â”‚                         â”‚
              â–¼                         â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DATA LAYER        â”‚   â”‚   MESSAGING LAYER   â”‚   â”‚   EXTERNAL SERVICES         â”‚
â”‚                     â”‚   â”‚                     â”‚   â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PostgreSQL   â”‚  â”‚   â”‚  â”‚   AWS SNS     â”‚  â”‚   â”‚  â”‚    Canvas LMS API     â”‚  â”‚
â”‚  â”‚  (AWS RDS)    â”‚  â”‚   â”‚  â”‚  (FIFO Topic) â”‚  â”‚   â”‚  â”‚   (canvas.vt.edu)     â”‚  â”‚
â”‚  â”‚  â€¢ 18 Tables  â”‚  â”‚   â”‚  â”‚               â”‚  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  â€¢ US-East-2  â”‚  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚          â”‚          â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                     â”‚   â”‚          â–¼          â”‚   â”‚  â”‚   Gmail SMTP Server   â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”‚  (Email Notifications)â”‚  â”‚
â”‚  â”‚  Milvus DB    â”‚  â”‚   â”‚  â”‚   AWS SQS     â”‚  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚  (AWS ECS)    â”‚  â”‚   â”‚  â”‚  (Queues)     â”‚  â”‚   â”‚                             â”‚
â”‚  â”‚  â€¢ Embeddings â”‚  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ BM25 Index â”‚  â”‚   â”‚          â”‚          â”‚   â”‚  â”‚   AWS Bedrock         â”‚  â”‚
â”‚  â”‚  â€¢ Per-Course â”‚  â”‚   â”‚          â–¼          â”‚   â”‚  â”‚  (Llama, Titan,       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”‚   Rerank)             â”‚  â”‚
â”‚                     â”‚   â”‚  â”‚ Lambda Workersâ”‚  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ â€¢ Notes Gen   â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚  â”‚ â€¢ Vectorize   â”‚  â”‚
                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 7.2 Storage Layers

| Layer | Technology | Purpose |
|-------|------------|---------|
| **Primary DB** | PostgreSQL (AWS RDS) | Transactional data |
| **Vector Store** | Milvus (AWS ECS + EFS) | Hybrid search embeddings |
| **Cache** | ConcurrentMapCacheManager | Canvas API response caching |
| **Session** | PostgreSQL | JWT session persistence |

---

# ğŸ“Œ 8. Architecture Evolution

## 8.1 From S3 Vectors to Milvus

The VT AI Lecture Assistant underwent a significant architecture evolution in its RAG (Retrieval-Augmented Generation) system. This section documents the transition from the initial S3 Vectors approach to the current Milvus-based hybrid search system.

### Phase 1: Initial Architecture (S3 Vectors)

**Timeline:** September - December 2025

The initial system used **AWS S3 Vectors** for vector storage and retrieval:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ORIGINAL ARCHITECTURE (S3 Vectors)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Vectorization   â”‚â”€â”€â”€â–¶â”‚  AWS S3 Vectors  â”‚â—€â”€â”€â”€â”‚  Flask QA        â”‚       â”‚
â”‚  â”‚  Worker (Lambda) â”‚    â”‚  (US-EAST-2)     â”‚    â”‚  Service         â”‚       â”‚
â”‚  â”‚                  â”‚    â”‚                  â”‚    â”‚                  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                        â”‚                        â”‚                  â”‚
â”‚         â–¼                        â–¼                        â–¼                  â”‚
â”‚   Bedrock Titan v1         Semantic Search          Claude 3.5 Sonnet       â”‚
â”‚   Embeddings               Only (Dense)             Answer Generation        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**S3 Vectors Configuration:**
```python
# Original vector storage
{
  "key": "course_1_note_123_chunk_0",
  "data": {"float32": [...]},
  "metadata": {
    "source": "notes|syllabus|assignment|announcement|module|page",
    "course_id": "1",
    "note_id": "123",
    "chunk_index": "0",
    "chunk_text": "...",
    "model": "amazon.titan-embed-text-v1",
    "timestamp": "2024-12-06T..."
  }
}
```

**S3 Vectors Characteristics:**
| Aspect | S3 Vectors |
|--------|------------|
| **Search Type** | Dense vector (semantic) only |
| **Index** | Managed by AWS |
| **Chunking** | 300 words, 40-word overlap |
| **Embedding Model** | Titan Embed v1 |
| **LLM** | Claude 3.5 Sonnet |
| **Reranking** | None |

### Phase 2: Current Architecture (Milvus)

**Timeline:** January 2026 - Present

The system was upgraded to use **Milvus** for enhanced hybrid search capabilities:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CURRENT ARCHITECTURE (Milvus)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Vectorization   â”‚â”€â”€â”€â–¶â”‚    Milvus DB     â”‚â—€â”€â”€â”€â”‚  Flask QA        â”‚       â”‚
â”‚  â”‚  Worker (Milvus) â”‚    â”‚  (AWS ECS)       â”‚    â”‚  Service         â”‚       â”‚
â”‚  â”‚                  â”‚    â”‚                  â”‚    â”‚                  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                        â”‚                        â”‚                  â”‚
â”‚         â–¼                        â–¼                        â–¼                  â”‚
â”‚   Bedrock Titan v2         Hybrid Search:          Llama 3.3 70B +          â”‚
â”‚   Embeddings               - Dense (70%)           Amazon Rerank v1         â”‚
â”‚   + BM25 Function          - BM25 (30%)                                     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Comparison: S3 Vectors vs Milvus

| Feature | S3 Vectors (Original) | Milvus (Current) |
|---------|----------------------|------------------|
| **Search Method** | Dense vector only | Hybrid (Dense + BM25) |
| **Keyword Matching** | None | Built-in BM25 |
| **Reranking** | None | Amazon Rerank v1 |
| **Embedding Model** | Titan v1 | Titan v2 (1024 dim) |
| **LLM** | Claude 3.5 Sonnet | Llama 3.3 70B |
| **Chunking** | 300 words / 40 overlap | 250 words / 50 overlap |
| **Index Type** | AWS Managed | HNSW + Sparse Inverted |
| **Partitioning** | Per-course buckets | Per-course partitions |
| **Deployment** | Serverless (S3) | ECS + EFS |
| **Initial Retrieval** | TOP_K = 6 | INITIAL_K = 50 |
| **Final Results** | 6 chunks | 10 chunks (after rerank) |

### Why We Migrated

| Challenge with S3 Vectors | Solution with Milvus |
|---------------------------|----------------------|
| **Semantic-only search** missed exact terms (dates, assignment names) | **Hybrid search** combines semantic understanding with keyword precision |
| **No reranking** led to suboptimal ordering | **Cross-encoder reranking** dramatically improves relevance |
| **Limited control** over index configuration | **HNSW tuning** allows optimization for our workload |
| **Single retrieval pass** | **Two-stage retrieval** (50 â†’ 10) improves precision |
| **Older embedding model** | **Titan v2** provides better semantic representation |

### Migration Process

1. **Schema Design:** Created unified Milvus collection with dense + sparse vectors
2. **Worker Update:** Modified vectorization worker to use Milvus client
3. **QA Service Update:** Implemented hybrid search with weighted ranker
4. **Reranking Integration:** Added Amazon Rerank v1 for second-stage ranking
5. **LLM Upgrade:** Switched from Claude to Llama 3.3 70B for cost efficiency
6. **Infrastructure:** Deployed Milvus standalone on ECS with EFS persistence

### Results

| Metric | S3 Vectors | Milvus | Improvement |
|--------|------------|--------|-------------|
| **Exact term recall** | ~70% | ~95% | +25% |
| **Answer relevance** | Good | Excellent | Significant |
| **Query latency** | ~2s | ~1.5s | -25% |
| **Cost per query** | Higher (Claude) | Lower (Llama) | ~60% reduction |

---

# ğŸ“Œ 9. Project History & Metrics

## 9.1 Code Metrics

### Total Lines of Code (Approximate)

| Service | Language | Lines (approx) | Files |
|---------|----------|----------------|-------|
| Java Backend | Java | ~8,500 | 88 |
| Frontend | TypeScript/TSX | ~4,500 | 34 |
| Flask QA Service (Milvus) | Python | ~2,500 | 14 |
| Vectorization Worker (Milvus) | Python | ~2,000 | 6 |
| Notes Generation Worker | JavaScript | ~350 | 6 |
| **TOTAL** | Mixed | **~17,850** | ~148 |

## 9.2 Architecture Timeline

| Date | Milestone |
|------|-----------|
| Sep 2024 | Initial system design and development begins |
| Oct 2024 | Frontend and backend scaffolding complete |
| Nov 2024 | S3 Vectors integration, notes generation |
| Dec 2024 | Dispute system, analytics, module sync |
| Jan 2026 | **Migration to Milvus architecture** |
| Jan 2026 | Hybrid search (Dense + BM25) implemented |
| Jan 2026 | Amazon Rerank v1 integration |
| Jan 2026 | LLM upgrade to Llama 3.3 70B |

---

# ğŸ“Œ 10. Bottlenecks, Risks & Improvements

## 10.1 Potential Performance Bottlenecks

| Bottleneck | Impact | Recommendation |
|------------|--------|----------------|
| Large Canvas API responses | Slow profile loading | Implement pagination, background sync |
| Embedding generation | Slow vectorization | Batch embeddings, parallel processing |
| Milvus query | QA latency | Tune HNSW parameters, partition pruning |
| Reranker API call | Added latency | Cache frequent queries, async reranking |
| Single Milvus instance | SPOF risk | Consider Milvus cluster mode |

## 10.2 Architectural Risks

| Risk | Severity | Mitigation |
|------|----------|------------|
| Single point of failure (Java Backend) | High | Deploy multiple instances, health checks |
| Milvus data loss | High | EFS backups, replication |
| JWT secret exposure | High | Use AWS Secrets Manager |
| Canvas API rate limits | Medium | Implement backoff, caching |
| Lambda cold starts | Medium | Provisioned concurrency |

## 10.3 Future Improvements

| Area | Improvement |
|------|-------------|
| **Search** | Implement query expansion for better recall |
| **Caching** | Add Redis for query result caching |
| **Monitoring** | Add Prometheus/Grafana for Milvus metrics |
| **Scaling** | Consider Milvus cluster for higher load |
| **Testing** | Add integration tests for RAG pipeline |

---

# ğŸ“Œ 11. Glossary

## Internal Terminology

| Term | Definition |
|------|------------|
| **Course Context** | The currently active/selected course for a user session |
| **Entity ID** | Database primary key for Student or Instructor |
| **External Mapping** | Link between internal IDs and Canvas IDs |
| **QA Log** | Record of a question-answer interaction |
| **QA Dispute** | Student complaint about an AI-generated answer |
| **Vectorization** | Process of converting text to vector embeddings |
| **Tool Calling** | LLM capability to execute functions (grades, TA notification) |
| **Hybrid Search** | Combining dense vector (semantic) and sparse vector (BM25) search |
| **Reranking** | Second-stage scoring using cross-encoder model |

## Acronyms

| Acronym | Full Form |
|---------|-----------|
| **VT** | Virginia Tech |
| **LMS** | Learning Management System |
| **QA** | Question & Answer |
| **RAG** | Retrieval-Augmented Generation |
| **JWT** | JSON Web Token |
| **SNS** | Simple Notification Service (AWS) |
| **SQS** | Simple Queue Service (AWS) |
| **RDS** | Relational Database Service (AWS) |
| **ECS** | Elastic Container Service (AWS) |
| **EFS** | Elastic File System (AWS) |
| **HNSW** | Hierarchical Navigable Small World (index type) |
| **BM25** | Best Matching 25 (keyword ranking algorithm) |
| **FIFO** | First-In-First-Out (queue type) |
| **SPA** | Single Page Application |

## Service Names

| Service | Description |
|---------|-------------|
| **VT-AI-Lecture-Assistant-Backend_Java** | Main API gateway (Spring Boot) |
| **VT-AI-Lecture-Assistant-Frontend** | React user interface |
| **milvus-flask-qa-service** | AI-powered QA service with Milvus (Python) |
| **vectorization-worker-milvus-version** | Lambda for content vectorization to Milvus |
| **notes-generation-worker** | Lambda for notes generation |

---

# Appendix: Quick Reference

## Service URLs (Development)

| Service | URL |
|---------|-----|
| Frontend | http://localhost:3000 |
| Java Backend | http://localhost:3167 |
| Flask QA (Milvus) | http://localhost:5000 |
| Milvus | http://localhost:19530 |

## Key Configuration Files

| Service | File | Purpose |
|---------|------|---------|
| Java Backend | `application.properties` | All configuration |
| Frontend | `.env` | API URL, timeout |
| Flask QA | `config.py` | Milvus, AWS, model settings |
| Vectorization | Environment vars | Lambda/ECS configuration |

## Health Check Endpoints

| Service | Endpoint | Expected Response |
|---------|----------|-------------------|
| Java Backend | `GET /api/health` | `{"status": "healthy"}` |
| Flask QA | `GET /health` | `{"status": "healthy", "service": "qa-service", "milvus": "connected"}` |

---

*This documentation was generated by analyzing the complete codebase. All information is derived from actual source code, configuration files, and project structure.*

**Document Version:** 2.0 (Milvus Architecture)
**Last Updated:** January 2026
**Authors:** AI Teaching Assistant Development Team

